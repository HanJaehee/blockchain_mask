<!doctype html>
<html lang="en">

  <head>
    <title>MaskSaver Dashboard</title>
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/data.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/modules/accessibility.js"></script>
    <script src="https://code.highcharts.com/js/themes/dark-unica.js"></script>

    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

    <!--     Fonts and icons     -->
    <link rel="stylesheet" type="text/css"
        href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:400,700|Material+Icons" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css">

    <!-- Material Kit CSS -->
    <link href="../assets/css/material-dashboard.css?v=2.1.2" rel="stylesheet" />

    <!-- Material Dashboard CSS -->
    <link rel="stylesheet" href="../assets/css/material-dashboard?v=2.1.2.css">
    <style>
        .highcharts-figure,
        .highcharts-data-table table {
            min-width: 310px;
            max-width: 1200px;
            margin: 1em auto;
        }

        #container {
            height: 400px;
        }

        .highcharts-data-table table {
            font-family: Verdana, sans-serif;
            border-collapse: collapse;
            border: 1px solid #EBEBEB;
            margin: 10px auto;
            text-align: center;
            width: 100%;
            max-width: 500px;
        }

        .highcharts-data-table caption {
            padding: 1em 0;
            font-size: 1.2em;
            color: #555;
        }

        .highcharts-data-table th {
            font-weight: 600;
            padding: 0.5em;
        }

        .highcharts-data-table td,
        .highcharts-data-table th,
        .highcharts-data-table caption {
            padding: 0.5em;
        }

        .highcharts-data-table thead tr,
        .highcharts-data-table tr:nth-child(even) {
            background: #f8f8f8;
        }

        .highcharts-data-table tr:hover {
            background: #f1f7ff;
        }
    </style>
</head>

<body>
  <div class="wrapper ">
    <div class="sidebar" data-color="purple" data-background-color="white">
      <!--
      Tip 1: You can change the color of the sidebar using: data-color="purple | azure | green | orange | danger"

      Tip 2: you can also add an image using data-image tag
  -->
      <div class="logo">
        <a href="../index.html" class="simple-text logo-mini">
          <img src="../assets/img/logo/logo.png" alt="">
        </a>
        <a class="simple-text logo-normal">
          MaskSaver
        </a>
      </div>
      <div class="sidebar-wrapper">
        <ul class="nav">
          <li class="nav-item active  ">
            <a class="nav-link" href="../seller/seller_dashboard.html">
              <i class="material-icons">dashboard</i>
              <p>Dashboard</p>
            </a>
          </li>
          <li class="nav-item ">
            <a class="nav-link" href="../seller/seller_inventory.html">
              <i class="material-icons">content_paste</i>
              <p>재고 내역</p>
            </a>
          </li>
          <li class="nav-item ">
            <a class="nav-link" href="../seller/seller_sold.html">
              <i class="material-icons">bubble_chart</i>
              <p>판매 내역</p>
            </a>
          </li>
          <li class="nav-item ">
            <a class="nav-link" href="../seller/seller_receipt.html">
              <i class="material-icons">library_books</i>
              <p>입고 내역</p>
            </a>
          </li>
          <li class="nav-item ">
            <a class="nav-link" href="../seller/seller_sell.html">
              <i class="material-icons">library_books</i>
              <p>판매하기</p>
            </a>
          </li>
          <!-- your sidebar here -->
        </ul>
      </div>
    </div>
    <div class="main-panel">
      <!-- Navbar -->
      <nav class="navbar navbar-expand-lg navbar-transparent navbar-absolute fixed-top">

        <div class="container-fluid">
            <div class="navbar-wrapper">
            </div>

            <div class="alert alert-primary" role="alert">
                <a id="id">로그인시 유저 정보가 보입니다.</a>
            </div>
        </div>
      </nav>
      <!-- End Navbar -->
      <div class="content">
        <div class="container-fluid">
            <!-- your content here -->
            <figure class="highcharts-figure">
                <div id="container"></div>
            </figure>

            <div class="row">
                <div class="col-md-4">
                    <div class="card card-chart">
                        <div class="card-header card-header-success">
                            <div class="ct-chart" id="dailySalesChart"></div>
                        </div>
                        <div class="card-body">
                            <h4 class="card-title">일별 재고량</h4>
                            <p class="card-category"> 매일 생산된 재고량을 나타냅니다.</p>
                        </div>
                        <div class="card-footer">
                            <div class="stats">
                                <i class="material-icons">access_time</i> updated 4 minutes ago
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card card-chart">
                        <div class="card-header card-header-warning">
                            <div class="ct-chart" id="websiteViewsChart"></div>
                        </div>
                        <div class="card-body">
                            <h4 class="card-title">일별 판매량</h4>
                            <p class="card-category">매일 생산된 생산량을 나타냅니다.</p>
                        </div>
                        <div class="card-footer">
                            <div class="stats">
                                <i class="material-icons">access_time</i> updated 4 minutes ago
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6 col-sm-6">
                  <div class="card">
                      <div class="card-header card-header-text card-header-primary">
                          <div class="card-text">
                            <h4 class="card-title">오늘의 재고량</h4>
                          </div>
                      </div>
                      <div class="card-body" id="inventory_cardbody"
                          style="font-weight: bold; font-size: 40sp;">
  
                      </div>
                  </div>
              </div>
            </div>
        </div>
    </div>
        <footer class="footer">
          <div class="container-fluid">
            <nav class="float-left">
              <ul>
                <li>
                  <a href="../index.html">
                    MaskSaver
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </footer>
      </div>
    </div>
  <script src="../assets/vendor/jquery/jquery-3.2.1.min.js"></script>
      <!-- 합쳐지고 최소화된 최신 자바스크립트 -->
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
      <!-- The core Firebase JS SDK is always required and must be listed first -->
      <script src="https://www.gstatic.com/firebasejs/7.14.0/firebase-app.js"></script>
  
      <!-- TODO: Add SDKs for Firebase products that you want to use
           https://firebase.google.com/docs/web/setup#available-libraries -->
      <script src="https://www.gstatic.com/firebasejs/7.14.0/firebase-analytics.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.14.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.14.0/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.14.0/firebase-firestore.js"></script>
  <script src="../assets/js/firebaseInit.js"></script>
  <script src="../assets/js/firebaseUserCheck.js"></script>
  <script src="../assets/js/myfunctions.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
  <script>
    userSessionCheck();
  </script>
  <script type="text/javascript">

    //구매자 리스트 테이블 만드는 함수
    function MakeBuyerListTable() {
      //DB저장하는 함수
      StoreBuyerListInDB();

      //테이블 만들기
      GetDataFromDB()
    }


    //구매자가 구매할 수 있는지 확인하는 함수
    function CanPurchase() {

      var name = document.getElementById('name').value;
      var civilNumber = document.getElementById('civilNumber').value;

      var canPurchase_query = db.collection("observer").doc("purchase_record").collection("record_set").where("name",
        "==", name).where("civilNumber", "==", civilNumber);

      var result = "";

      return canPurchase_query
        .get()
        .then(function (querySnapshot) {
          querySnapshot.forEach(function (doc) {
            // doc.data() is never undefined for query doc snapshots
            result += doc.data().time;
          });
          if (result) {
            console.log("canPurchase", false);
            alert(false);
            return false;
          } else {
            alert(true);
            console.log("canPurchase", true);
            return true;
          }
        })
        .catch(function (error) {
          alert(false);
          console.log("Error getting documents: ", error);
          return false;
        });



    }

  </script>
  <script type="text/javascript">
    //인증 시간 지연으로 인해 만듬
    //인증 상태가 변화하면 GetDataFromDB() 함수 호출
    firebase.auth().onAuthStateChanged(function (user) {
      if (user) {
        // User is signed in.
        window.onload = GetDataFromDB();
      } else {
        // No user is signed in.
      }
    });
     //일일 입고량 판매량 가져오는 함수
     function getDaily() {
                    var today = new Date();
                    today = moment(today).format('YYYY-MM-DD');
                    var docRef4 = db.collection("users").doc(firebaseEmailAuth.currentUser.uid).collection('daily').doc(
                        today);

                    console.log("today = ", today);
                    var result = "";
                    docRef4.get().then(function (doc) {
                        if (doc.exists) {
                            result = doc.data()
                            console.log("Document data:", doc.data());
                        } else {
                            // doc.data() will be undefined in this case
                            console.log("No such document!");
                            return;
                        }
                    }).catch(function (error) {
                        console.log("Error getting document:", error);
                    });
                }
  </script>
  <!-- httpRequest JSON parsing script -->
  <script type="text/javascript">
    firebaseEmailAuth.onAuthStateChanged(function (user) {

      if (user) {
        //로그인 성공한 유저 id 확인해 보기 - firebase database에 접근해서 데이터 조회 하는 함수
        var docRef = db.collection("users").doc(firebaseEmailAuth.currentUser.uid);

        docRef.get().then(function (doc) {
          if (doc.exists) {
            userAddr = doc.data().addr;
            userName = doc.data().name;
            userEmail = user.email;
            console.log(user.email + " 님이 로그인했습니다." + " 계좌 : " + userAddr + " 이름 :" + userName);
            getInventorySize();
            getDaily();
            getWarningList();//이게 판매사에 필요한지는 논의중
            getStockOnlyForSeller();
          } else {
            // doc.data() will be undefined in this case
            console.log("No such document!");
          }
        }).catch(function (error) {
          console.log("Error getting document:", error);
        });
        return true;
      }
    });
    
  </script>
<script>
  function getStockOnlyForSeller(){
    console.log("getStockOnlyForSeller() 호출");
  var ourRequest = new XMLHttpRequest();
  ourRequest.open('GET',
      'https://us-central1-maskproject-6e385.cloudfunctions.net/maskSaver/stockList/' +
      firebaseEmailAuth.currentUser.uid);
  ourRequest.onload = function () {
      var ourData = JSON.parse(ourRequest.responseText);
      console.log(ourData);
      setInventoryCardbody(ourData);
  };
  ourRequest.send();
  }
</script>

<script>
  Highcharts.chart('container', {
      credits: {
          enabled: false
      },
      chart: {
          type: 'column'
      },
      title: {
          text: '생산량, 판매량 추이'
      },
      subtitle: {
          text: 'from MaskSaver'
      },
      xAxis: {
          categories: [
              '2020-05-29',
              '2020-05-30',
              '2020-05-31',
              '2020-06-01',
              '2020-06-02',
              '2020-06-03',
              '2020-06-04',
              '2020-06-05',
              '2020-06-06',
              '2020-06-07',
              '2020-06-08',
              '2020-06-09'
          ],
          crosshair: true
      },
      yAxis: {
          min: 0,
          title: {
              text: 'Quantity (piece)'
          }
      },
      tooltip: {
          headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
          pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
              '<td style="padding:0"><b>{point.y:.1f} piece</b></td></tr>',
          footerFormat: '</table>',
          shared: true,
          useHTML: true
      },
      plotOptions: {
          column: {
              pointPadding: 0.2,
              borderWidth: 0
          }
      },
      series: [{
          name: '재고량',
          data: [20000, 36000, 41000, 28000, 33000, 48000, 42000, 37000, 29000, 27000, 36000,
              45000
          ]

      }, {
          name: '판매량',
          data: [16000, 10000, 13000, 18000, 22000, 15000, 14000, 17000, 25000, 24000, 26000,
              28000
          ]
      }]
  });
</script>
<script>
  $(document).ready(function () {
      // Javascript method's body can be found in assets/js/demos.js
      md.initDashboardPageCharts();

  });
</script>

</body>

</html>